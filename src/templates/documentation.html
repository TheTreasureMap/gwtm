{% extends "base.html" %}

{% block content %}
<style>

    /* Create two equal columns that floats next to each other */
    .column {
    float: left;
    width: 50%;
    padding: 5px;
    }

    /* Clear floats after the columns */
    .row:after {
    content: "";
    display: table;
    clear: both;
    }
</style>
    
<div style="padding-left:16px">
<h2>Documentation</h2>

<p>Communicating with the Treasure Map to either report or get information is best done programmatically through the API using POST and GET methods (see below). However, one can also use the pages on this website to report and get the information. Below are examples of two use cases for the API methods.</p>
We have two versions of the API, as a consequence of my adolescence in API programming in 2019... <b>We recommend using <i>/api/v1</i></b>
<ul>
    <li class="alert alert-warning"><b>You must use <a>https://treasuremap.space</a> as your api base url. Using <i>http</i> will result in an error.</b></li>
    <li class="alert alert-info"><i><a>/api/v0</a></i>: This version's GET responses <b>does not</b> return valid JSON. When iterating over the results, you'd have to json.parse() each result in the result list.</li>
    <li class="alert alert-info"><i><a>/api/v1</a></i>: This version's GET responses does return valid JSON. You only have to perform json.parse(request.text) once then interate over the JSON objects as expected.</li>
</ul>
You can find these API endpoints utilized in our <a href="jupyter_tutorial">Jupyter notebook tutorial</a>.<br>

We also point users to a Python script produced by a Treasure Map user, Dougal Dobie, and shared in the spirit of the Treasure Map community <a href='https://github.com/ddobie/TreasureMapPy'> on Github here</a>, that manages pointing uploads to Treasure Map using the API defined below.<br>
<br>

<ol>
    <li><b>I am an observer and I would like to report my observations</b><br>
        <p>
            Great! Before you can start you must register an account through this website. Then you will be issued a token that you will use to post your reports. <br>
            Once you have an account, also please check whether your imaging instrument is listed (either on the <a href="/search_instruments">website</a> or by using the instruments GET method - see below), and make a note of its ID. If it isn't listed, please submit it. <br>
        </p>

            Once you and your instrument are registered, here's a typical scenario to follow: <b>(You may test your <em>POST</em> scripts using one of the test events graceids listed <a href="/alert_select?role=test&observing_run=O4">here</a>.)</b><br>
        <ul>
            <li>A GW alert comes in, and you or your software decide on a list of pointings to observe with your telescope.</li> 
            <li>You send this list of pointings using the pointings POST method (see below), with a status of <em><b>planned</b></em>.</li>
            <li>As you observe your pointings you send them (either one by one as they are observed, or in bulk) with the same POST method but this time with a status of <em><b>completed</b></em>.</li>
            <ul>
                <li>For validation of your efforts you can request a <a href="https://www.doi.org">DOI</a> for your completed pointings as you post them in bulk, or after the fact through the api endpoint for a list of pointing IDs</li>
                <li>To create an author list for your DOI, please visit your <a href="/manage_user">Profile</a> page and follow the links to do so. Use the ID of your group in requesting the DOI. Otherwise you can still submit a json object via the API (described below). Authors do <b>not</b> have to be GWTM users</li>
            </ul>
            <li>If there are pointings you had submitted as planned but then realize you will not get to, you can cancel them (so that others know that they won't be covered).</li>
        </ul>
        <p></p>
    <li>
        <b>I would like to see what others are observing in order to plan my observations accordingly</b>
        <p>
                You are required to register. Use your API token you receive upon registration along with the pointings GET method (see below) to retrieve reported planned or completed pointings for a specific GW alert, time window, instrument, and/or band.
        </p>
    </li>
</ol>

<h2>API Endpoints:</h2>

<div class="shadow-lg p-3 mb-5 bg-white rounded">
    <h3 class="text-center">Pointings</h3>

    <div class="accordion" id="pointingsCollapse">
        <div class="card">
            <div class="card-header" id="get_pointing_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#get_pointingCollapse" aria-expanded="false" aria-controls="get_pointingCollapse">
                        GET Pointing
                    </button>
                </h2>
            </div>
        </div>
        <div id="get_pointingCollapse" class="collapse" aria-labelledby="get_pointing_hdr" data-parent="#pointingsCollapse">
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/get_pointing_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="getptexample_acc">
                            <div class="card">
                                <div class="card-header" id="getptex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#getptex1" aria-expanded="false" aria-controls="getptex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="getptex1" class="collapse show" aria-labelledby="getptex1hdr" data-parent="#getptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/get_pointing_example1.html' %}
                                    </div>
                                </div>

                                <div class="card-header" id="getptex2hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#getptex2" aria-expanded="false" aria-controls="getptex2">
                                            Example 2
                                        </button>
                                    </h2>
                                </div>
                                <div id="getptex2" class="collapse" aria-labelledby="getptex2hdr" data-parent="#getptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/get_pointing_example2.html' %}
                                    </div>
                                </div>

                                <div class="card-header" id="getptex3hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#getptex3" aria-expanded="false" aria-controls="getptex3">
                                            Example 3
                                        </button>
                                    </h2>
                                </div>
                                <div id="getptex3" class="collapse" aria-labelledby="getptex3hdr" data-parent="#getptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/get_pointing_example3.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="post_pointing_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#post_pointingCollapse" aria-expanded="false" aria-controls="post_pointingCollapse">
                        POST Pointing
                    </button>
                </h2>
            </div>
        </div>
        <div id="post_pointingCollapse" class="collapse" aria-labelledby="post_pointing_hdr" data-parent="#pointingsCollapse" aria-expanded="false">   
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/post_pointing_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="postptexample_acc">
                            <div class="card">
                                <div class="card-header" id="postptex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#postptex1" aria-expanded="false" aria-controls="postptex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="postptex1" class="collapse show" aria-labelledby="postptex1hdr" data-parent="#postptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/post_pointing_example1.html' %}
                                    </div>
                                </div>

                                
                                <div class="card-header" id="postptex2hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#postptex2" aria-expanded="false" aria-controls="postptex2">
                                            Example 2
                                        </button>
                                    </h2>
                                </div>
                                <div id="postptex2" class="collapse" aria-labelledby="postptex2hdr" data-parent="#postptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/post_pointing_example2.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="doireq_pointing_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#doireq_pointingCollapse" aria-expanded="false" aria-controls="doireq_pointingCollapse">
                        Pointing DOI Request
                    </button>
                </h2>
            </div>
        </div>
        <div id="doireq_pointingCollapse" class="collapse" aria-labelledby="doireq_pointing_hdr" data-parent="#pointingsCollapse" aria-expanded="false">   
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/doireq_pointing_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="doireqptexample_acc">
                            <div class="card">
                                <div class="card-header" id="doireqptex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#doireqptex1" aria-expanded="false" aria-controls="doireqptex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="doireqptex1" class="collapse show" aria-labelledby="doireqptex1hdr" data-parent="#doireqptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/doireq_pointing_example1.html' %}
                                    </div>
                                </div>
                                <div class="card-header" id="doireqptex2hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#doireqptex2" aria-expanded="false" aria-controls="doireqptex2">
                                            Example 2
                                        </button>
                                    </h2>
                                </div>
                                <div id="doireqptex2" class="collapse" aria-labelledby="doireqptex2hdr" data-parent="#doireqptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/doireq_pointing_example2.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="update_pointing_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#update_pointingCollapse" aria-expanded="false" aria-controls="update_pointingCollapse">
                        Update Pointing (status: planned -> cancelled)
                    </button>
                </h2>
            </div>
        </div>
        <div id="update_pointingCollapse" class="collapse" aria-labelledby="update_pointing_hdr" data-parent="#pointingsCollapse" aria-expanded="false">   
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/update_pointing_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="updateptexample_acc">
                            <div class="card">
                                <div class="card-header" id="updateptex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#updateptex1" aria-expanded="false" aria-controls="updateptex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="updateptex1" class="collapse show" aria-labelledby="updateptex1hdr" data-parent="#updateptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/update_pointing_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="cancelall_pointing_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#cancelall_pointingCollapse" aria-expanded="false" aria-controls="cancelall_pointingCollapse">
                        Cancel all planned Pointings
                    </button>
                </h2>
            </div>
        </div>
        <div id="cancelall_pointingCollapse" class="collapse" aria-labelledby="cancellall_pointing_hdr" data-parent="#pointingsCollapse" aria-expanded="false">   
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/cancelall_pointing_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="cancelallptexample_acc">
                            <div class="card">
                                <div class="card-header" id="cancelallptex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#cancelallptex1" aria-expanded="false" aria-controls="cancelallptex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="cancelallptex1" class="collapse show" aria-labelledby="cancelallptex1hdr" data-parent="#cancelallptexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/cancelall_pointing_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="shadow-lg p-3 mb-5 bg-white rounded">
    <h3 class="text-center">Instruments</h3>

    <div class="accordion" id="instrumentsCollapse">
        <div class="card">
            <div class="card-header" id="get_inst_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#get_instCollapse" aria-expanded="false" aria-controls="get_instCollapse">
                        GET Instrument
                    </button>
                </h2>
            </div>
        </div>
        <div id="get_instCollapse" class="collapse" aria-labelledby="get_inst_hdr" data-parent="#instrumentsCollapse">
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/get_instruments_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="getinstexample_acc">
                            <div class="card">
                                <div class="card-header" id="getinstex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#getinstex1" aria-expanded="false" aria-controls="getinstex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="getinstex1" class="collapse show" aria-labelledby="getinstex1hdr" data-parent="#getinstexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/get_instruments_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="get_foot_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#get_footCollapse" aria-expanded="false" aria-controls="get_footCollapse">
                        GET Footprint
                    </button>
                </h2>
            </div>
        </div>
        <div id="get_footCollapse" class="collapse" aria-labelledby="get_foot_hdr" data-parent="#instrumentsCollapse">
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/get_footprints_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="getfootexample_acc">
                            <div class="card">
                                <div class="card-header" id="getfootex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#getfootex1" aria-expanded="false" aria-controls="getfootex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="getfootex1" class="collapse show" aria-labelledby="getfootex1hdr" data-parent="#getfootexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/get_footprints_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="shadow-lg p-3 mb-5 bg-white rounded">
    <h3 class="text-center">Convolved Galaxies</h3>

    <div class="accordion" id="convgalCollapse">
        <div class="card">
            <div class="card-header" id="get_convgal_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#get_convgalCollapse" aria-expanded="false" aria-controls="get_convgalCollapse">
                        GET Convolved Galaxies
                    </button>
                </h2>
            </div>
        </div>
        <div id="get_convgalCollapse" class="collapse" aria-labelledby="get_convgal_hdr" data-parent="#convgalCollapse">
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/get_convgal_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="getconvgalexample_acc">
                            <div class="card">
                                <div class="card-header" id="getconvgalex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#getconvgalex1" aria-expanded="false" aria-controls="getconvgalex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="getconvgalex1" class="collapse show" aria-labelledby="getconvgalex1hdr" data-parent="#getconvgalexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/get_convgal_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="post_convgal_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#post_convgalCollapse" aria-expanded="false" aria-controls="post_convgalCollapse">
                        POST Convolved Galaxies
                    </button>
                </h2>
            </div>
        </div>
        <div id="post_convgalCollapse" class="collapse" aria-labelledby="post_convgal_hdr" data-parent="#convgalCollapse">
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/post_convgal_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="postconvgalexample_acc">
                            <div class="card">
                                <div class="card-header" id="postconvgalex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#postconvgalex1" aria-expanded="false" aria-controls="postconvgalex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="postconvgalex1" class="collapse show" aria-labelledby="postconvgalex1hdr" data-parent="#postconvgalexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/post_convgal_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="del_convgal_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#del_convgalCollapse" aria-expanded="false" aria-controls="del_convgalCollapse">
                        DELETE Convolved Galaxies
                    </button>
                </h2>
            </div>
        </div>
        <div id="del_convgalCollapse" class="collapse" aria-labelledby="del_convgal_hdr" data-parent="#convgalCollapse">
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/del_convgal_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="delconvgalexample_acc">
                            <div class="card">
                                <div class="card-header" id="delconvgalex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#delconvgalex1" aria-expanded="false" aria-controls="delconvgalex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="delconvgalex1" class="collapse show" aria-labelledby="delconvgalex1hdr" data-parent="#delconvgalexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/del_convgal_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="shadow-lg p-3 mb-5 bg-white rounded">
    <h3 class="text-center">GRB Multi-Order Coverage (MOC) Maps</h3>

    <div class="accordion" id="grbmocCollapse">
        <div class="card">
            <div class="card-header" id="get_grbmoc_hdr">
                <h2 class="mb-0">
                    <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#get_grbmocCollapse" aria-expanded="false" aria-controls="get_grbmocCollapse">
                        GET MOC File
                    </button>
                </h2>
            </div>
        </div>
        <div id="get_grbmocCollapse" class="collapse" aria-labelledby="get_grbmoc_hdr" data-parent="#grbmocCollapse">
            <div class="row">
                <div class="column">
                    <div class="card card-body">
                        {% include 'api_docs/get_grbmoc_instructions.html' %}
                    </div>
                </div>
                <div class="column">
                    <div class="card card-body">
                        <div class="accordion" id="getgrbmocexample_acc">
                            <div class="card">
                                <div class="card-header" id="getgrbmocex1hdr">
                                    <h2 class="mb-0">
                                        <button class="btn btn-primary btn-block text-left" type="button" data-toggle="collapse" data-target="#getgrbmocex1" aria-expanded="false" aria-controls="getgrbmocex1">
                                            Example 1
                                        </button>
                                    </h2>
                                </div>
                                <div id="getgrbmocex1" class="collapse show" aria-labelledby="getgrbmocex1hdr" data-parent="#getgrbmocexample_acc">
                                    <div class="card-body">
                                        {% include 'api_docs/get_grbmoc_example1.html' %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
 
</div>

    <script type="text/javascript">
        window.onload = function(){
            var code_eles = document.getElementsByClassName('python_code');
            for (i = 0; i < code_eles.length; i++) {
                var codeElement = code_eles[i];
                // Add code mirror class for coloring (default is the theme)
                codeElement.classList.add( 'cm-s-default' );
                var code = codeElement.innerText;

                codeElement.innerHTML = "";

                CodeMirror.runMode(
                    code,
                    'python',
                    codeElement
                );
            }
            
        };
    </script>
    
    </body>

{% endblock %}